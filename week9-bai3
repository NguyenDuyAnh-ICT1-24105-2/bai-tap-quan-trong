#include <stdio.h>
#include <math.h>

// 1️⃣ Hàm tính số e theo công thức: e = 1 + 1/1! + 1/2! + 1/3! + ...
double tinhE(double epsilon) {
    double e = 1.0;
    double term = 1.0;
    int i = 1;

    while (term > epsilon) {
        term = term / i;
        e += term;
        i++;
    }
    return e;
}

// 2️⃣ Hàm tính số pi theo công thức Leibniz: pi/4 = 1 - 1/3 + 1/5 - 1/7 + ...
double tinhPi(double epsilon) {
    double pi = 0.0;
    double term;
    double mau = 1.0;
    int dau = 1;

    do {
        term = dau * (1.0 / mau);
        pi += term;
        mau += 2;
        dau = -dau;
    } while (fabs(term) >= epsilon);

    return pi * 4;
}

// 3️⃣ Hàm tính sin(x) theo chuỗi Taylor
// sin(x) = x - x^3/3! + x^5/5! - x^7/7! + ...
double tinhSin(double x, double epsilon) {
    double sinx = 0.0;
    double term = x;   // số hạng đầu tiên
    int i = 1;
    int dau = 1;

    while (fabs(term) >= epsilon) {
        sinx += dau * term;
        i += 2;
        term = term * x * x / (i * (i - 1)); // tính số hạng tiếp theo
        dau = -dau; // đổi dấu
    }
    return sinx;
}

// ------------------------- MAIN --------------------------
int main() {
    double epsilon;
    int chon;
    char tieptuc;
    double x;

    printf("Nhap do chinh xac epsilon (0 < epsilon < 1): ");
    scanf("%lf", &epsilon);

    do {
        printf("\n===== CHUONG TRINH TINH =====\n");
        printf("1 - So pi\n");
        printf("2 - So e\n");
        printf("3 - sin(x)\n");
        printf("An phim khac de thoat.\n");
        printf("Moi ban lua chon chuong trinh: ");
        scanf("%d", &chon);

        switch (chon) {
            case 1:
                printf("Ban da chon tinh so pi\n");
                printf("So pi = %.10lf\n", tinhPi(epsilon));
                break;
            case 2:
                printf("Ban da chon tinh so e\n");
                printf("So e = %.10lf\n", tinhE(epsilon));
                break;
            case 3:
                printf("Ban da chon tinh sin(x)\n");
                printf("Nhap x (tinh theo radian): ");
                scanf("%lf", &x);
                printf("sin(%.4lf) = %.10lf\n", x, tinhSin(x, epsilon));
                break;
            default:
                printf("Thoat chuong trinh.\n");
                return 0;
        }

        printf("Ban co muon tiep tuc chuong trinh? (y/n): ");
        scanf(" %c", &tieptuc);

    } while (tieptuc == 'y' || tieptuc == 'Y');

    printf("Ket thuc chuong trinh.\n");
    return 0;
}
